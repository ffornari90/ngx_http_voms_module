# This file is a template, and might need editing before it works on your project.
# Official docker image.
image: storm2/ngx-voms-build:latest

stages:
  - build
  - test

#before_script:
#  - source ${HOME}/openresty-env
  
build:
  stage: build
  script:
    - env | sort
    - id
    # ngx_http_voms_module build
    - sh ${HOME}/build-install-ngx-voms.sh
    - cp -r ${HOME}/local localtemp
  artifacts:
    paths:
      - localtemp

test:
  stage: test
  dependencies:
    - build
  script:
    - ls -al localtemp
    - cp -r localtemp ${HOME}/local
    - chmod +x ${HOME}/local/openresty/bin/openresty
    - source ${HOME}/openresty-env
    - env | sort
    - id
    # ngx_http_voms_module test
    #- sh ${HOME}/build-install-ngx-voms.sh
    - cp -r t /tmp
    - cd /tmp
    - prove -v
